---
import '../styles/article-list.css';
import '../styles/project-card.css';

import {Image} from "astro:assets";
import { getCollection } from "astro:content";
import Card from "../components/Card.astro";
import Icon from "../components/Icon.astro";
import Layout from "../layouts/Layout.astro";
import { openGraph } from 'spectre:globals';

const projects = await getCollection('projects');
---
<Layout
	title={openGraph.projects.title || "Projets"}
	description={openGraph.projects.description}
	pagefindIgnore
>
  <div class="layout-grid-left" slot="left">
    <Card class="flex-col-card">
      <h2 class="no-mt">Stats</h2>
			<div class="stats-div">
				<div class="stat">
					<h3 class="text-glow">{projects.length}</h3>
					<span>Project{projects.length === 1 ? '' : 's'}</span>
				</div>
			</div>
    </Card>
  </div>
  <div class="layout-grid-right" slot="right">
	  <Card>
		  <div class="header-container">
			  <Icon type='lucide' name="folder-git" width={24} height={24} class='glow-icon' />
			  <h2>Projets</h2>
		  </div>
		  <div class="content-container">
			  {
				  projects
					  /* On s'assure que l'ID existe bien avant de trier */
					  .filter((p) => typeof p.data.id === 'number')
					  /* Tri croissant : petit ID (1) vers grand ID (10) */
					  .sort((a, b) => a.data.id - b.data.id)
					  .slice(0, 2)
					  .map((project) => (
						  <a href={`/Portfolio/projects/${project.id}`} class="post-container with-thumbnail">
							  <div class="post-content">
								  <div class="post-header">
									  <h3>{project.data.title}</h3>
								  </div>
								  <span>{project.data.description}</span>
							  </div>

							  {/* Image à droite */}
							  <div class="post-thumbnail">
								  <Image
									  src={project.data.image}
									  alt={project.data.title}
									  width={280}
									  class="project-thumb-img"
								  />
							  </div>
						  </a>
					  ))
			  }

			  {/* Message de debug si la liste est vide (à retirer plus tard) */}
			  {projects.length === 0 && <p>Aucun projet trouvé (vérifie le dossier src/content/projects)</p>}
		  </div>
	  </Card>
  </div>
</Layout>
<style>
	.stats-div {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.stat {
		display: flex;
		flex-direction: column;
	}

	.stat h3 {
		font-size: 2em;
		margin: 0;
		margin-bottom: .5rem;
	}

</style>
